@startuml Service Level Permissions

skinparam activityBackgroundColor LightBlue
skinparam activityBorderColor DarkBlue
skinparam activityDiamondBackgroundColor LightYellow
skinparam activityDiamondBorderColor DarkOrange
skinparam noteBackgroundColor LightGreen
skinparam noteBorderColor DarkGreen

title Agentic Service Bot - Service Level Permissions Flow

start

:User sends request;

:Chat Lambda processes request;

:Anthropic API analyzes request;

note right
  Stage 1: Identify primary action
  Stage 2: Extract context
end note

:Get customer's service level;

:Get service level permissions;

note right
  Service Levels:
  - Basic: device_status, device_power
  - Premium: Basic + volume_control
  - Enterprise: Premium + song_changes
end note

if (Is action allowed for service level?) then (yes)
  if (Action requires device to be on?) then (yes)
    if (Device is on?) then (yes)
      :Execute action;
      :Generate success response;
    else (no)
      :Generate "device is off" response;
    endif
  else (no)
    :Execute action;
    :Generate success response;
  endif
else (no)
  :Determine required service level;
  
  if (Current level is basic?) then (yes)
    if (Action is volume_control?) then (yes)
      :Generate "upgrade to premium" response;
    else (no)
      :Generate "upgrade to enterprise" response;
    endif
  else (premium)
    :Generate "upgrade to enterprise" response;
  endif
endif

:Save message to DynamoDB;

:Return response to user;

stop

@enduml 